@page
@model IndexModel
<!DOCTYPE html>
<html>
<head>
    <title>Aste Attive</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .countdown { font-weight: bold; color: #dc3545; }
        .card:hover { transform: translateY(-5px); transition: 0.2s; }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-primary">
    <div class="container">
        <span class="navbar-brand">🏆 Asta La Vista 2.0</span>
        <span class="text-white">
            Ciao, @Model.UserName | 
            💰 Portafoglio: €@Model.UserWallet
            @if (HttpContext.Session.GetString("IsAdmin") == "True")
            {
                <text> | <a href="/Admin" class="text-white">⚙️ Admin</a></text>
            }
        </span>
    </div>
</nav>

    <div class="container mt-4">
        <h2 class="mb-4">Aste Attive</h2>
        
        <div class="row g-3">
            @foreach (var auction in Model.Auctions)
            {
                var isWinning = auction.Bids.OrderByDescending(b => b.Amount).FirstOrDefault()?.UserId == Model.UserId;
                
                <div class="col-md-4">
    <div class="card @(isWinning ? "border-success" : "")">
        @if (!string.IsNullOrEmpty(auction.ImageUrl))
        {
            <img src="@auction.ImageUrl" class="card-img-top" alt="@auction.Title" style="height: 200px; object-fit: cover;">
        }
        else
        {
            <div class="bg-secondary text-white d-flex align-items-center justify-content-center" style="height: 200px;">
                <h1>📦</h1>
            </div>
        }
        <div class="card-body">
            <h5>@auction.Title</h5>
            <p class="text-muted small">@auction.Description</p>
            <h4 class="text-success">€@auction.CurrentPrice</h4>
            <div class="countdown" data-end="@auction.EndDate.ToString("O")">Calcolo...</div>
            @if (isWinning)
            {
                <div class="badge bg-success mt-2">🏆 Sei in testa!</div>
            }
            <a href="/Auction?id=@auction.Id" class="btn btn-primary btn-sm mt-2 w-100">Fai offerta</a>
        </div>
    </div>
</div>
            }
        </div>
    </div>

    <script>
        setInterval(() => {
            document.querySelectorAll('.countdown').forEach(el => {
                const end = new Date(el.dataset.end);
                const diff = end - new Date();
                if (diff <= 0) {
                    el.innerHTML = '⏰ Terminata';
                    el.classList.add('text-danger');
                } else {
                    const h = Math.floor(diff / 3600000);
                    const m = Math.floor((diff % 3600000) / 60000);
                    el.innerHTML = `⏰ ${h}h ${m}m`;
                }
            });
        }, 1000);
    </script>
</body>
</html>